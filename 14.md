볼륨 마운트

볼륨은 스토리지의 한 영역을 분할한 것

마운트는 연결하다는 의미 그대로 대상을 연결해 운영체제 또는 소프트웨어의 관리 하에 두는 일을 말한다.

마운트되지 않음 → 컨테이너가 외부에 있는 데이터를 다룰 수 없다

마운트 됨 → 컨테이너가 외부에 있는 데이터를 다룰 수 있다.

실제로 컨테이너를 사용하려면 스토리지 영역을 마운트해야 한다. 데이터가 스토리지에 있기 때문

컨테이너를 종료해도 성격상 쓰고 버려야 하기 때문에 언젠가는 삭제될 것.

이런 상황에서 컨테이너 속에 데이터가 있다면 컨테이너와 함께 데이터도 소멸된다. 

컨테이너는 생성 및 폐기가 매우 빈번하기 때문에 매번 데이터를 옮기는 대신 처음부터 컨테이너 외부에 둔 데이터에 접근해 사용하는 것이 일반적, 이를 데이터 퍼시스턴시 data persistency라고 한다. 이때 데이터를 두는 장소가 마운트된 스토리지 영역

스토리지 마운트라고 한다면 의미가 모호하기 때문에 관례적으로 ‘볼륨 마운트’라는 용어를 사용. 마운트 대상이 되는 스토리지는 볼륨 외에도 디렉터리나 파일, 메모리가 될 수도 있다.

스토리지 마운트의 종류

볼륨 마운트, 바인드 마운트

볼륨 마운트

볼륨 마운트는 도커 엔진이 관리하는 영역 내에 만들어진 볼륨을 컨테이너에 디스크 형태로 마운트한다.

이름만으로 관리가 가능하므로 다루기 쉽지만 볼륨에 비해 직접 조작하기 어려우므로 ‘임시 목적의 사용’이나 ‘자주 쓰지는 않지만 지우면 안 되는 파일’을 두는 목적으로 많이 사용한다.

바인드 마운트

바인드 마운트는 도커가 설치된 컴퓨터의 문서 폴더 또는 바탕화면 폴더 등 도커 엔진에서 관리하지 않는 영역의 기존 디렉터리를 컨테이너에 마운트하는 방식이다.

디렉터리가 아닌 파일 단위로도 마운트가 가능하다

디럭터리 속에 파일을 직접 두거나 열어볼 수 있기 때문에 자주 사용하는 파일을 두는 데 사용한다.

두 가지 마운트 방식의 차이점

두 가지 마운트 방식의 차이점은 간단한지 복잡한지

호스트 컴퓨터에서 파일을 다룰 필요가 있는지

환경의 의존성을 배제해야 하는지

볼륨 마운트는 도커 엔진의 관리 하에 있으므로 사용자가 파일 위치를 신경 쓸 필요가 없다

바탕화면에 내버려 뒀다가 실수로 지워버리는 일도 일어나지 않는다

운영체제에 따라 명령어가 달라지는 등 의존성 문제도 일어나지 않는다. 예를 들어 윈도우와 macOS, 리눅스는 경로를 기재하는 방식이 제각각 다르다. 따라서 리눅스 사용자가 만든 컨테이너를 윈도우 사용자나 macOS 사용자가 이용하려면 기재된 경로를 수정해야 한다. 그러나 볼륨 마운트를 사용한다면 이러한 작업이 필요 없다. 환경에 따라 경로가 바뀌는 일도 없다.

즉 볼륨 마운트는 익숙해지면 손쉽게 사용할 수 있다. 그런만큼 도커 제작사에서도 볼륨 마운트 사용을 권장한다.

하지만 볼륨 마운트는 도커 컨테이너를 경유하지 않고 직접 볼륨에 접근할 방법이 없다. 억지로 볼륨을 수정하고자 하면 볼륨 자체가 깨질 우려도 있다. 백업을 하려고 해도 복잡한 절차가 필요하다.

반면 바인드 마운트는 도커가 관리하지 않는 영역 어디라도 파일을 둘 수 있으며, 기존과 동일한 방식으로 파일을 사용할 수 있으므로 다른 소프트웨어를 사용해 쉽게 편집할 수 있다. 도커 엔진과 무관하게 파일을 다룰 수 있다.

자주 편집해야 하는 경우에는 바인드 마운트를 사용해야 한다. 

이처럼 간편함과 파일 접근 가능 여부에 차이가 있으므로 파일을 직접 편집해야 할 일이 많다면 바인드 마운트를 사용하고, 그렇지 않다면 볼륨 마운트를 사용하면 된다.

볼륨 마운트

스토리지 영역은 볼륨

물리적 위치는 도커엔진의 관리영역

마운드 절차는 볼륨을 생성한 후 마운트

도커 컨테이너를 통해서 내용 편집

백업 절차가 복잡함

바인드 마운트

스토리지 영역은 디렉터리 또는 파일

물리적 위치는 어디든지 가능

마운드 절차는 기존 파일 또는 폴더를 마운트

일반적인 파일과 같이 내용 편집

백업 절차는 일반 파일과 같이

임시 메모리(tmpfs) 마운트

임시 메모리 마운트 방식.

임시 메모리 마운트는 디스크가 아닌 주 메모리 영역을 마운트, 디스크보다 훨씬 빠른 속도로 읽고 쓰기가 가능하기 때문에 접근 속도를 높일 목적으로 사용하지만 도커 엔진이 정지되거나 호스트가 재부팅하면 소멸한다.

스토리지 영역을 마운트하는 커맨드

스토리지 마운트는 run 커맨드의 옵션 형태로 지정

마운트하려는 스토리지의 경로가 컨테이너 속 특정 경로와 연결되도록 설정하는 형태

마운트되는 스토리지는 본래 별도의 장소에 있지만 마치 컨테이너 안에 있는 것처럼 설정하는 것. 단축 아이콘 만드는 것이랑 비슷

마운트 원본이 되는 스토리지 영역의 위치와 마운트 대상이 되는 위치는 경로 형태로 지정.

데이터가 위치하는 경로는 도커 이미지의 참조 문서 등을 보면 알 수 있다.

스토리지를 마운트하는 절차

스토리지를 마운트하려면 먼저 마운트될 스토리지를 생성해야 한다.

볼륨 마운트의 경우, 마운트와 동시에 볼륨(스토리지 영역)을 만들 수도 있지만. 권장하지 않고 마운트 전에 별도로 볼륨을 먼저 생성하는 것이 좋다.<< 이거는 왜 그런거지

스토리지 영역을 만드는 방법

바인드 마운트는 원본이 될 디렉터리나 파일을 먼저 만든다. 경로는 어디라도 상관없다. 

볼륨 마운트는 볼륨 상위 커맨드를 사용해 먼저 볼륨을 생성한다.

볼륨 생성(볼륨 마운트)

docker volume create 볼륨_이름

볼륨 삭제

docker volume rm 볼륨_이름

docker volume create

볼륨을 생성

docker volume inspect

볼륨의 상세 정보를 출력

docker volume ls

볼륨의 목록을 출력

docker volume prune

현재 마운트되지 않은 볼륨을 모두 삭제

docker volume rm

지정한 볼륨을 삭제

스토리지를 마운트하는 커맨드

-v 옵션 뒤에 스토리지 실제 경로 또는 볼륨 이름, 컨테이너 마운트 경로 순서대로 기재

이들 경로는 콜론(:)을 사용해 구분

바인드 마운트는 볼륨을 마운트하지 않지만 볼륨 마운트와 마찬가지로 -v 옵션을 사용한다.

볼륨 마운트 커맨드의 예

docker run (…) -v 볼륨_이름:컨테이너_마운트_경로 (…)

바인드 마운트 커맨드의 예

docker run (…) -v 스토리지_실제_경로:컨테이너_마운트_경로 (…)