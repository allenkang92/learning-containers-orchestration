# 3. 다중 Nginx 컨테이너 실행

이번에는 여러 개의 Nginx 컨테이너를 동시에 실행하는 방법을 알아봅니다. 핵심은 각 컨테이너가 호스트 머신의 서로 다른 포트에 연결되도록 설정하는 것입니다. 컨테이너 내부의 포트는 이미지를 만든 사람이 지정한 것이므로 일반적으로 변경할 수 없지만, 호스트의 포트는 자유롭게 설정할 수 있습니다.

## 3.1 첫 번째 Nginx 컨테이너

### 3.1.1 컨테이너 생성
다음 명령어를 사용하여 첫 번째 Nginx 컨테이너를 실행합니다. 컨테이너는 고유한 호스트 포트에 매핑됩니다.

```bash
docker run -d --name nginx1 -p 8081:80 nginx:latest
```

명령어 설명:

- `-d`: 컨테이너를 백그라운드에서 실행합니다.
- `--name nginx1`: 컨테이너의 이름을 지정합니다.
- `-p 8081:80`: 호스트의 8081 포트를 컨테이너의 80 포트에 매핑합니다.
- `nginx:latest`: 사용할 이미지 이름입니다.

### 3.1.2 상태 확인
다음 명령어를 사용하여 첫 번째 Nginx 컨테이너의 상태를 확인합니다.

```bash
docker ps | grep nginx1
```

출력 결과에서 `nginx1` 컨테이너가 정상적으로 실행 중인지 확인합니다.

## 3.2 두 번째 Nginx 컨테이너

### 3.2.1 컨테이너 생성
다음 명령어를 사용하여 두 번째 Nginx 컨테이너를 실행합니다. 컨테이너는 고유한 호스트 포트에 매핑됩니다.

```bash
docker run -d --name nginx2 -p 8082:80 nginx:latest
```

명령어 설명:

- `-d`: 컨테이너를 백그라운드에서 실행합니다.
- `--name nginx2`: 컨테이너의 이름을 지정합니다.
- `-p 8082:80`: 호스트의 8082 포트를 컨테이너의 80 포트에 매핑합니다.
- `nginx:latest`: 사용할 이미지 이름입니다.

### 3.2.2 상태 확인
다음 명령어를 사용하여 두 번째 Nginx 컨테이너의 상태를 확인합니다.

```bash
docker ps | grep nginx2
```

출력 결과에서 `nginx2` 컨테이너가 정상적으로 실행 중인지 확인합니다.

## 3.3 컨테이너 관리

### 3.3.1 로그 확인
다음 명령어를 사용하여 두 개의 Nginx 컨테이너의 로그를 확인합니다.

```bash
docker logs nginx1
docker logs nginx2
```

출력 결과에서 각 컨테이너의 로그를 확인합니다.

### 3.3.2 컨테이너 중지
다음 명령어를 사용하여 두 개의 Nginx 컨테이너를 중지합니다.

```bash
docker stop nginx1 nginx2
```

## 3.4 커스텀 설정

### 3.4.1 설정 파일 마운트
다음 명령어를 사용하여 세 번째 Nginx 컨테이너를 실행합니다. 컨테이너는 호스트의 설정 파일을 마운트합니다.

```bash
docker run -d --name nginx3 \
  -v /host/nginx.conf:/etc/nginx/nginx.conf:ro \
  -p 8083:80 \
  nginx:latest
```

명령어 설명:

- `-d`: 컨테이너를 백그라운드에서 실행합니다.
- `--name nginx3`: 컨테이너의 이름을 지정합니다.
- `-v /host/nginx.conf:/etc/nginx/nginx.conf:ro`: 호스트의 설정 파일을 컨테이너의 설정 파일에 마운트합니다.
- `-p 8083:80`: 호스트의 8083 포트를 컨테이너의 80 포트에 매핑합니다.
- `nginx:latest`: 사용할 이미지 이름입니다.

### 3.4.2 환경 변수 설정
다음 명령어를 사용하여 네 번째 Nginx 컨테이너를 실행합니다. 컨테이너는 환경 변수를 설정합니다.

```bash
docker run -d --name nginx4 \
  -e NGINX_HOST=example.com \
  -p 8084:80 \
  nginx:latest
```

명령어 설명:

- `-d`: 컨테이너를 백그라운드에서 실행합니다.
- `--name nginx4`: 컨테이너의 이름을 지정합니다.
- `-e NGINX_HOST=example.com`: 환경 변수를 설정합니다.
- `-p 8084:80`: 호스트의 8084 포트를 컨테이너의 80 포트에 매핑합니다.
- `nginx:latest`: 사용할 이미지 이름입니다.

## 3.5 리소스 제한

### 3.5.1 메모리 제한
다음 명령어를 사용하여 다섯 번째 Nginx 컨테이너를 실행합니다. 컨테이너는 메모리 제한을 설정합니다.

```bash
docker run -d --name nginx5 \
  --memory="512m" \
  -p 8085:80 \
  nginx:latest
```

명령어 설명:

- `-d`: 컨테이너를 백그라운드에서 실행합니다.
- `--name nginx5`: 컨테이너의 이름을 지정합니다.
- `--memory="512m"`: 메모리 제한을 설정합니다.
- `-p 8085:80`: 호스트의 8085 포트를 컨테이너의 80 포트에 매핑합니다.
- `nginx:latest`: 사용할 이미지 이름입니다.

### 3.5.2 CPU 제한
다음 명령어를 사용하여 여섯 번째 Nginx 컨테이너를 실행합니다. 컨테이너는 CPU 제한을 설정합니다.

```bash
docker run -d --name nginx6 \
  --cpus="1.5" \
  -p 8086:80 \
  nginx:latest
```

명령어 설명:

- `-d`: 컨테이너를 백그라운드에서 실행합니다.
- `--name nginx6`: 컨테이너의 이름을 지정합니다.
- `--cpus="1.5"`: CPU 제한을 설정합니다.
- `-p 8086:80`: 호스트의 8086 포트를 컨테이너의 80 포트에 매핑합니다.
- `nginx:latest`: 사용할 이미지 이름입니다.